{% extends "base.html" %}

{% block title %}Customer List{% endblock %}

{% block content %}
<style>
    .content-container { padding: 2em; background-color: #f8f9fa; min-height: 100vh; }
    .page-header { margin-bottom: 1.5em; }
    .page-header h1 { margin: 0; font-size: 2rem; color: #343a40; }

    #searchInput { width: 100%; padding: 0.75em; border: 1px solid #ced4da; border-radius: 0.25rem; font-size: 1rem; margin-bottom: 1.5em; }

    .table-container { overflow-x: auto; background: white; border-radius: 0.25rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 1em; text-align: left; border-bottom: 1px solid #dee2e6; white-space: nowrap; }
    th { background-color: #e9ecef; font-weight: 600; color: #495057; }
    tbody tr:hover { background-color: #f1f1f1; cursor: pointer; }

    .modal-dialog { max-width: 650px; }
    .modal-content { border-radius: 0.75rem; border: none; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .modal-header { border-bottom: 1px solid #e9ecef; padding: 1.25rem 1.5rem; }
    .modal-title { font-weight: 600; font-size: 1.2rem; }
    .modal-body { padding: 1.5rem; max-height: 65vh; overflow-y: auto; }
    .form-field-group .form-label { font-weight: 600; margin-bottom: .5rem; color: #495057; }
    .form-field-group { margin-bottom: 1rem; }
</style>

<div class="content-container">
    <div class="page-header">
        <h1>Customer List</h1>
    </div>

    <input type="text" id="searchInput" placeholder="Search customers based on keywords...">

    <div class="table-container">
        <table id="customersTable">
            <thead>
                <tr>
                    <th>Customer ID</th>
                    <th>Name</th>
                    <th>Email</th>
                    <th>Phone</th>
                </tr>
            </thead>
            <tbody>
                {% if customers %}
                    {% for cust in customers %}
                    <tr data-customer='{{ cust | tojson | safe }}'>
                        <td>{{ cust.contact_id }}</td>
                        <td>{{ cust.contact_name }}</td>
                        <td>{{ cust.email }}</td>
                        <td>{{ cust.phone or cust.mobile }}</td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="4" class="text-center py-4">No customers found.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>
</div>

<!-- Modal to show full details -->
<div class="modal fade" id="detailsModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Customer Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" id="detailsContent"></div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const tableBody = document.querySelector('#customersTable tbody');
    const searchInput = document.getElementById('searchInput');
    const detailsModal = new bootstrap.Modal(document.getElementById('detailsModal'));
    const detailsContent = document.getElementById('detailsContent');

    // Search functionality
    searchInput.addEventListener('input', () => {
        const term = searchInput.value.toLowerCase();
        tableBody.querySelectorAll('tr').forEach(row => {
            const text = row.textContent.toLowerCase();
            row.style.display = text.includes(term) ? '' : 'none';
        });
    });

    // Row click event to show modal
    tableBody.addEventListener('click', e => {
        const row = e.target.closest('tr');
        if (!row) return;

        const customer = JSON.parse(row.dataset.customer);
        detailsContent.innerHTML = '';

        for (const [key, value] of Object.entries(customer)) {
            detailsContent.insertAdjacentHTML('beforeend', `
                <div class="form-field-group">
                    <label class="form-label">${key.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase())}</label>
                    <div>${value !== null && value !== '' ? value : '-'}</div>
                </div>
            `);
        }

        detailsModal.show();
    });
});
</script>
{% endblock %}
